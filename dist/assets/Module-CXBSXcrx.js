import{u as Z,r as o,j as t,M as $,B as P,a as S,G as p,g as ee,P as te,I as k,T as w,F as ae,h as se,S as re,k as oe,C as ne,L as de,l as le}from"./index-DvYQWpR8.js";import{d as ie,T as ce,a as ue,b as me,c as L,e as W,f as he,g as pe,D as je,h as ge,i as xe}from"./Add-DE-rMGZW.js";import{h as A}from"./moment-G82_0lEo.js";import{f as fe,a as be,b as ye,u as De,d as Ne}from"./ModuleApi-BBI_U3Z5.js";import{v as Ie}from"./kpscApi-DHTzs8Ro.js";import{E as Se,D as Ce}from"./Edit-D3ArGjJU.js";const F=[{id:"moduleId",label:"ID",align:"center"},{id:"moduleName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:150,align:"center"},{id:"subjectName",label:"Subjects",align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Created Date",align:"center"},{id:"updatedDate",label:"Modified Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],ke=()=>{Z();const[x,C]=o.useState(0),[j,O]=o.useState(10),[M,R]=o.useState([]),[v,U]=o.useState([]),[H,d]=o.useState(!1),[f,b]=o.useState(!1),[n,u]=o.useState({moduleName:"",description:""}),[l,y]=o.useState({}),[D,T]=o.useState(!1),[m,h]=o.useState([]),[z,B]=o.useState(null),G=(e,s)=>{C(s)},V=e=>{O(+e.target.value),C(0)},N=JSON.parse(sessionStorage.getItem("user")),i={"Content-type":"application/json",Authorization:"Bearer "+N.accessToken},g=async()=>{try{const s=(await fe(i)).data.content||[];console.log(s);const r=s.map(a=>{var c;return{moduleId:a.moduleId,moduleName:a.moduleName,description:a.description,subjectName:((c=a.subjectDtoList)==null?void 0:c.map(Y=>Y.subjectName).join(", "))||"No subject",insertedDate:A(a.insertedDate).format("L"),updatedDate:A(a.updatedDate).format("L"),createdBy:a.createdBy?a.createdBy.userName:"No User",updatedBy:a.updatedBy?a.updatedBy.userName:"No User"}});U(r)}catch(e){console.error("Error fetching modules:",e)}},J=async()=>{try{const s=(await Ie(i)).data||[];console.log(s);const r=s.sort((a,c)=>a.subjectName.localeCompare(c.subjectName));R(r)}catch(e){console.error("Error fetching subjects:",e)}};o.useEffect(()=>{g(),J()},[D]);const E=()=>{const e={};return n.moduleName.trim()||(e.moduleName="Enter the module name"),n.description.trim()||(e.description="Enter the description"),m.length===0&&(e.subjectId="Select at least one subject"),e},I=e=>{e.target.name==="subjectId"?h(e.target.value):u({...n,[e.target.name]:e.target.value}),y({...l,[e.target.name]:null})},_=()=>{b(!1),u({moduleName:"",description:""}),h([]),d(!0)},q=async e=>{e.preventDefault();const s=E();if(Object.keys(s).length>0){y(s);return}const r={moduleName:n.moduleName,description:n.description,subjectDtoList:m.map(a=>({subjectId:a})),createdBy:{userId:N.userId}};try{const a=await be(r,i);a.data.responseCode===201?(T(!D),d(!1),u({moduleName:"",description:""}),h([])):alert(a.data.errorMessage||"Failed to add module.")}catch(a){console.error("Error adding module:",a)}finally{g(),d(!1)}},K=async e=>{b(!0),d(!0);try{const r=(await ye(e,i)).data;B(r.moduleId);const a=r.subjectDtoList?r.subjectDtoList.map(c=>c.subjectId):[];h(a),u({moduleName:r.moduleName,description:r.description})}catch(s){console.error("Error fetching subject details:",s)}},Q=async e=>{e.preventDefault();const s=E();if(Object.keys(s).length>0){y(s);return}const r={moduleId:z,moduleName:n.moduleName,description:n.description,subjectDtoList:m.map(a=>({subjectId:a})),updatedBy:{userId:N.userId}};try{const a=await De(r,i);a.data.responseCode===201?(T(!D),d(!1),b(!1),B(null),u({moduleName:"",description:""}),h([])):alert(a.data.errorMessage)}catch{}finally{g(),d(!1)}},X=async e=>{try{await Ne(e,i),g()}catch(s){console.error("Error deleting subject:",s)}};return t.jsxs($,{title:t.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:"Modules"}),t.jsxs(S,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:_,children:["Add",t.jsx(ie,{sx:{color:"#fff"}})]})]}),children:[t.jsx(p,{container:!0,spacing:ee}),t.jsxs(te,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(ce,{sx:{maxHeight:440},children:t.jsxs(ue,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(me,{children:t.jsx(L,{children:F.map(e=>t.jsx(W,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(he,{children:v.slice(x*j,x*j+j).map(e=>t.jsx(L,{hover:!0,role:"checkbox",tabIndex:-1,children:F.map(s=>t.jsx(W,{align:s.align,children:s.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(k,{color:"primary",onClick:()=>{K(e.moduleId)},children:t.jsx(Se,{})}),t.jsx(k,{color:"error",onClick:()=>{X(e.moduleId)},children:t.jsx(Ce,{})})]}):e[s.id]||"No Data"},s.id))},e.moduleId))})]})}),t.jsx(pe,{rowsPerPageOptions:[10,25,100],component:"div",count:v.length,rowsPerPage:j,page:x,onPageChange:G,onRowsPerPageChange:V})]}),t.jsxs(je,{open:H,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[t.jsx(ge,{sx:{fontSize:"16px"},children:f?"Edit Module":"Add Module"}),t.jsxs(P,{component:"form",onSubmit:f?Q:q,noValidate:!0,sx:{p:3},children:[t.jsxs(p,{container:!0,spacing:2,children:[t.jsx(p,{item:!0,xs:12,children:t.jsx(w,{fullWidth:!0,label:"Module Name",name:"moduleName",value:n.moduleName,onChange:I,error:!!l.moduleName,helperText:l.moduleName})}),t.jsx(p,{item:!0,xs:12,children:t.jsx(w,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:I,error:!!l.description,helperText:l.description,multiline:!0,rows:3})}),t.jsx(p,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,error:!!l.subjectId,children:[t.jsx(se,{children:"Subjects"}),t.jsx(re,{multiple:!0,name:"subjectId",value:m,onChange:I,renderValue:e=>e.map(s=>{var r;return(r=M.find(a=>a.subjectId===s))==null?void 0:r.subjectName}).join(", "),children:M.map(e=>t.jsxs(oe,{value:e.subjectId,children:[t.jsx(ne,{checked:m.indexOf(e.subjectId)>-1}),t.jsx(de,{primary:e.subjectName})]},e.subjectId))}),t.jsx(le,{children:l.subjectId})]})})]}),t.jsxs(xe,{children:[t.jsx(S,{type:"submit",variant:"contained",color:"primary",children:f?"Update":"Add"}),t.jsx(S,{onClick:()=>d(!1),color:"primary",children:"Cancel"})]})]})]})]})};export{ke as default};
