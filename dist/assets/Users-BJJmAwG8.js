import{b,c as x,u as Z,r as d,j as a,M as ee,B as k,a as C,G as m,g as ae,P as re,I as M,T as p,F as se,h as te,S as le,k as oe,l as ne}from"./index-DvYQWpR8.js";import{d as ie,T as de,a as ce,b as me,c as v,e as U,f as ue,g as he,D as fe,h as ge,i as pe}from"./Add-DE-rMGZW.js";import{h as W}from"./moment-G82_0lEo.js";import{f as be}from"./RoleApi-DFSzNHn1.js";import{E as xe,D as Ne}from"./Edit-D3ArGjJU.js";const je=async n=>await b({method:"GET",url:`${x}/userprofile/v1/getAllUserProfileByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:n}),ye=async(n,c)=>{try{return await b({method:"POST",url:`${x}/userprofile/v1/createUserProfile`,headers:c,data:n}).then(function(t){console.log(t),t.data.responseCode===201?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)})}catch(t){alert(t)}},we=async(n,c)=>await b({method:"GET",url:`${x}/userprofile/v1/getUserProfileByUserId/{userId}?userId=${n}`,headers:c}),Ie=async(n,c)=>(console.log(n),await b({method:"PUT",url:`${x}/userprofile/v1/updateUserProfile`,headers:c,data:n}).then(function(t){console.log(t),t.data.responseCode===201?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(function(t){console.log(t)})),De=async(n,c)=>await b({method:"delete",url:`${x}/userprofile/v1/deleteUserProfileByUserId/${n}`,headers:c}).then(t=>{t.data.responseCode===200?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(t=>{console.log(t)}),E=[{id:"userId",label:"ID",align:"center"},{id:"userName",label:"Name",align:"center"},{id:"email",label:"Email",align:"center"},{id:"mobileNumber",label:"Mobile Number",align:"center"},{id:"roleName",label:"Role",minWidth:150},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],Se=()=>{Z();const[n,c]=d.useState(0),[t,A]=d.useState(10),[F,$]=d.useState([]),[j,P]=d.useState([]),[z,u]=d.useState(!1),[y,S]=d.useState(!1),[s,w]=d.useState({userName:"",fullName:"",email:"",mobileNumber:"",password:""}),[i,g]=d.useState({}),[T,I]=d.useState(!1),[O,H]=d.useState(null),G=(e,r)=>{c(r)},L=e=>{A(+e.target.value),c(0)},D=JSON.parse(sessionStorage.getItem("user")),h={"Content-type":"application/json",Authorization:"Bearer "+D.accessToken},B=async()=>{try{const r=(await je(h)).data.content;if(r){const o=r.map(l=>({userId:l.userId,userName:l.userName,fullName:l.fullName,email:l.email,mobileNumber:l.mobileNumber,password:l.password,roleName:l.roleDto?l.roleDto.roleName:"No Role Name",insertedDate:W(l.insertedDate).format("L"),updatedDate:W(l.updatedDate).format("L"),createdBy:l.createdBy?l.createdBy.userName:"No User",updatedBy:l.updatedBy?l.updatedBy.userName:"No User"}));P(o)}else P([])}catch(e){console.error("Error fetching users:",e)}},J=async()=>{try{const r=(await be(h)).data;if(r){const l=r.sort((N,Y)=>N.roleName.localeCompare(Y.roleName)).map(N=>({roleId:N.roleId,roleName:N.roleName}));$(l)}}catch(e){console.error("Error fetching roles:",e)}};d.useEffect(()=>{B(),J()},[T]);const R=()=>{const e={};return(!s.userName||s.userName.trim()==="")&&(e.userName="Enter the user name"),(!s.fullName||s.fullName.trim()==="")&&(e.fullName="Enter the full name"),!s.email||s.email.trim()===""?e.email="Enter the email Id":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(e.email="Enter a valid email address"),!s.mobileNumber||s.mobileNumber.trim()===""?e.mobileNumber="Enter the mobile number":/^[0-9]{10,15}$/.test(s.mobileNumber)||(e.mobileNumber="Enter a valid mobile number"),!s.password||s.password.trim()===""?e.password="Enter the password":s.password.length<6&&(e.password="Password must be at least 6 characters"),s.roleId||(e.roleId="Select a role"),e},f=e=>{w({...s,[e.target.name]:e.target.value}),g({...i,[e.target.name]:null})},V=()=>{S(!1),w({userName:"",fullName:"",email:"",mobileNumber:"",password:""}),g({}),u(!0)},_=async e=>{e.preventDefault();const r=R();if(Object.keys(r).length>0){g(r);return}const o={userName:s.userName,fullName:s.fullName,email:s.email,mobileNumber:s.mobileNumber,password:s.password,roleDto:{roleId:s.roleId},createdBy:{userId:D.userId}};console.log(o);try{const l=await ye(o,h);l.data.responseCode===201?(I(!T),u(!1),B()):alert(l.data.errorMessage||"Failed to add user.")}catch{}},q=async e=>{S(!0),u(!0);try{const o=(await we(e,h)).data;console.log(o),H(o.userId),w({userName:o.userName,fullName:o.fullName,email:o.email,mobileNumber:o.mobileNumber,password:o.password,roleId:o.roleDto?o.roleDto.roleId:""}),g({})}catch(r){console.error("Error fetching user details:",r)}},K=async()=>{try{const e={...s,userId:O,updatedBy:{userId:D.userId}},r=await Ie(e,h);console.log("User updated:",r),I(o=>!o),u(!1)}catch(e){console.error("Error updating user:",e)}},Q=async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{await De(e,h),I(r=>!r)}catch(r){console.error("Error deleting user:",r)}},X=async e=>{e.preventDefault();const r=R();if(Object.keys(r).length>0){g(r);return}y?await K():await _(e)};return a.jsxs(ee,{title:a.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:"User Management"}),a.jsxs(C,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:V,children:["Add",a.jsx(ie,{sx:{color:"#fff",ml:1}})]})]}),children:[a.jsx(m,{container:!0,spacing:ae}),a.jsxs(re,{sx:{width:"100%",overflow:"hidden",mt:2},children:[a.jsx(de,{sx:{maxHeight:440},children:a.jsxs(ce,{stickyHeader:!0,"aria-label":"sticky table",children:[a.jsx(me,{children:a.jsx(v,{children:E.map(e=>a.jsx(U,{align:e.align?e.align:"left",style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),a.jsxs(ue,{children:[j.slice(n*t,n*t+t).map(e=>a.jsx(v,{hover:!0,role:"checkbox",tabIndex:-1,children:E.map(r=>{const o=e[r.id];return a.jsx(U,{align:r.align?r.align:"left",children:r.id==="actions"?a.jsxs(a.Fragment,{children:[a.jsx(M,{color:"primary",onClick:()=>q(e.userId),children:a.jsx(xe,{})}),a.jsx(M,{color:"error",onClick:()=>Q(e.userId),children:a.jsx(Ne,{})})]}):o||"No Data"},r.id)})},e.userId)),j.length===0&&a.jsx(v,{children:a.jsx(U,{colSpan:E.length,align:"center",children:"No users found."})})]})]})}),a.jsx(he,{rowsPerPageOptions:[10,25,100],component:"div",count:j.length,rowsPerPage:t,page:n,onPageChange:G,onRowsPerPageChange:L})]}),a.jsxs(fe,{open:z,onClose:()=>u(!1),fullWidth:!0,maxWidth:"md",children:[a.jsx(ge,{sx:{fontSize:"16px"},children:y?"Edit User":"Add User"}),a.jsxs(k,{component:"form",noValidate:!0,sx:{p:3},onSubmit:X,children:[a.jsxs(m,{container:!0,spacing:2,children:[a.jsx(m,{item:!0,xs:12,children:a.jsx(p,{fullWidth:!0,label:"User Name",name:"userName",value:s.userName,onChange:f,error:!!i.userName,helperText:i.userName})}),a.jsx(m,{item:!0,xs:12,children:a.jsx(p,{fullWidth:!0,label:"Full Name",name:"fullName",value:s.fullName,onChange:f,error:!!i.fullName,helperText:i.fullName})}),a.jsx(m,{item:!0,xs:12,children:a.jsx(p,{fullWidth:!0,label:"Email",name:"email",value:s.email,onChange:f,error:!!i.email,helperText:i.email})}),a.jsx(m,{item:!0,xs:12,children:a.jsx(p,{fullWidth:!0,label:"Mobile Number",name:"mobileNumber",value:s.mobileNumber,onChange:f,error:!!i.mobileNumber,helperText:i.mobileNumber})}),a.jsx(m,{item:!0,xs:12,children:a.jsx(p,{fullWidth:!0,label:"Password",name:"password",type:"password",value:s.password,onChange:f,error:!!i.password,helperText:i.password})}),a.jsx(m,{item:!0,xs:12,children:a.jsxs(se,{fullWidth:!0,error:!!i.roleId,children:[a.jsx(te,{children:"Role"}),a.jsx(le,{name:"roleId",value:s.roleId,onChange:f,label:"Role",children:F.map(e=>a.jsx(oe,{value:e.roleId,children:e.roleName},e.roleId))}),i.roleId&&a.jsx(ne,{children:i.roleId})]})})]}),a.jsxs(pe,{children:[a.jsx(C,{onClick:()=>u(!1),children:"Cancel"}),a.jsx(C,{type:"submit",variant:"contained",color:"primary",children:y?"Update":"Save"})]})]})]})]})};export{Se as default};
