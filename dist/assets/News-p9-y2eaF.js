import{b as u,c,u as ee,r as i,j as e,M as te,d as F,a as x,G as f,g as ae,P as se,I as $,T as y}from"./index-DvYQWpR8.js";import{h as k}from"./moment-G82_0lEo.js";import{d as ne,T as re,a as oe,b as ie,c as U,e as A,f as le,g as de,D as ce,h as he,i as pe}from"./Add-DE-rMGZW.js";import{d as ue,a as me}from"./DeleteForever-BLSPA7Rs.js";const ge=async(r,d)=>{try{return await u({method:"POST",url:`${c}/news/v1/createNews`,headers:d,data:r}).then(function(a){a.data.responseCode===201?alert("Advertisement  added successfully"):a.data.responseCode===400&&alert(a.data.errorMessage)})}catch(a){alert(a)}},fe=async r=>await u({method:"get",url:`${c}/news/v1/getAllNewsByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:r}),we=async(r,d)=>await u({method:"GET",url:`${c}/news/v1/getNewsById/{newsId}?newsId=${r}`,headers:d}),xe=async(r,d)=>(console.log(r),await u({method:"PUT",url:`${c}/news/v1/updateNews`,headers:d,data:r}).then(function(a){a.data.responseCode===201?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(function(a){console.log(a)})),Ne=async(r,d)=>await u({method:"delete",url:`${c}/news/v1/deleteNewsById/${r}`,headers:d}).then(a=>{a.data.responseCode===200?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(a=>{console.log(a)}),W=[{id:"newsId",label:"ID",align:"center"},{id:"newsName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"file",label:"File",align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],Pe=()=>{ee();const[r,d]=i.useState(0),[a,M]=i.useState(10),[j,b]=i.useState([]),[N,I]=i.useState(!1),[R,h]=i.useState(!1),[z,O]=i.useState(null),[ye,C]=i.useState(""),[p,D]=i.useState({}),[P,G]=i.useState(null),S=i.useRef(null),[je,v]=i.useState(""),[H,B]=i.useState(!1),[l,m]=i.useState({newsName:"",description:""}),_=(t,s)=>{d(s)},L=t=>{M(+t.target.value),d(0)},w=JSON.parse(sessionStorage.getItem("user")),g={"Content-type":"application/json",Authorization:`Bearer ${w.accessToken}`},J=`${c}/file/downloadFile/?filePath=`,T=async()=>{try{const s=(await fe(g)).data.content;if(s){const n=s.map(o=>({newsId:o.newsId,newsName:o.newsName,description:o.description,file:o.photoPath?e.jsx("img",{src:J+o.photoPath,alt:o.photoName,style:{width:150,height:100}}):"NO IMAGE FOUND",insertedDate:k(o.insertedDate).format("L"),updatedDate:k(o.updatedDate).format("L"),createdBy:o.createdBy?o.createdBy.userName:"No User",updatedBy:o.updatedBy?o.updatedBy.userName:"No User"}));b(n)}else b([])}catch(t){console.error("Error fetching data:",t)}};i.useEffect(()=>{T()},[H]);const V=()=>{const t={};return l.newsName.trim()||(t.newsName="Enter the News"),l.description.trim()||(t.description="Enter the Description"),(!l.photoName||l.photoName.trim()==="")&&(t.photoName="Select the file"),t},E=t=>{m({...l,[t.target.name]:t.target.value}),D(s=>({...s,[t.target.name]:null}))},q=async t=>{I(!0),h(!0);try{const n=(await we(t,g)).data;O(n.newsId),m({newsName:n.newsName,description:n.description,photoName:n.photoName})}catch(s){console.error("Error fetching news by ID:",s)}},K=async t=>{if(t.preventDefault(),!P){v("Please select a file");return}const s=new FormData;s.append("file",P);try{const n=await u.post(`${c}/file/uploadFile`,s,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${w.accessToken}`}});C(n.data.fileName),m(o=>({...o,photoName:n.data.fileName})),v(""),alert(n.data.message),console.log(n.data)}catch(n){console.error("Error uploading file:",n)}},Q=t=>{C(t.target.files[0].name),G(t.target.files[0])},X=()=>{I(!1),m({newsName:"",description:"",photoName:""}),h(!0)},Y=async t=>{t.preventDefault();const s=V();if(console.log(l),Object.keys(s).length>0)D(s);else{try{if(N){const n={...l,newsId:z,updatedBy:{userId:w.userId}};await xe(n,g)}else{const n={...l,createdBy:{userId:w.userId}};await ge(n,g)}m({newsName:"",description:"",photoName:""}),S.current.value=null,B(n=>!n),h(!1)}catch(n){console.error("Error saving news:",n)}T(),h(!1)}},Z=async t=>{try{await Ne(t,g),B(s=>!s)}catch(s){console.error("Error deleting news:",s)}};return e.jsxs(te,{title:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"News"}),e.jsxs(x,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:X,children:["Add",e.jsx(ne,{sx:{color:"#fff"}})]})]}),children:[e.jsx(f,{container:!0,spacing:ae}),e.jsxs(se,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(re,{sx:{maxHeight:440},children:e.jsxs(oe,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ie,{children:e.jsx(U,{children:W.map(t=>e.jsx(A,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(le,{children:j.slice(r*a,r*a+a).map(t=>e.jsx(U,{hover:!0,role:"checkbox",tabIndex:-1,children:W.map(s=>e.jsx(A,{align:s.align,children:s.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx($,{onClick:()=>q(t.newsId),color:"primary",children:e.jsx(ue,{})}),e.jsx($,{onClick:()=>Z(t.newsId),color:"error",children:e.jsx(me,{})})]}):t[s.id]},s.id))},t.newsId))})]})}),e.jsx(de,{rowsPerPageOptions:[10,25,100],component:"div",count:j.length,rowsPerPage:a,page:r,onPageChange:_,onRowsPerPageChange:L})]}),e.jsxs(ce,{open:R,onClose:()=>h(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(he,{sx:{fontSize:"16px"},children:N?"Edit News":"Add News"}),e.jsxs(F,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"News Name",name:"newsName",value:l.newsName,onChange:E,error:!!p.newsName,helperText:p.newsName})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Description",name:"description",value:l.description,onChange:E,error:!!p.description,helperText:p.description,multiline:!0,rows:3})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(y,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:l.photoName,disabled:!0,helperText:p.photoName,error:!!p.photoName,InputProps:{endAdornment:e.jsx(x,{variant:"contained",color:"primary",onClick:K,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:S,style:{marginTop:20}})]})]}),e.jsxs(pe,{children:[e.jsx(x,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:N?"Update":"Save"})]})]})]})]})};export{Pe as default};
