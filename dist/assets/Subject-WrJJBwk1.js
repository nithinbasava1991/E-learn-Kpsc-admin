import{o as Y,q as G,s as K,t as B,r as c,v as Q,w as V,j as t,x as X,y as Z,b as ee,u as te,M as se,B as ae,a as w,P as oe,I as L,T as k,F as re,h as ne,S as ie,k as de}from"./index-DvYQWpR8.js";import{j as ce,d as le,T as ue,a as je,b as be,c as R,e as l,f as pe,g as he,D as me,h as ge,i as fe}from"./Add-DE-rMGZW.js";import{h as A}from"./moment-G82_0lEo.js";import{q as xe,c as Pe,r as ye,s as Ie,t as De}from"./kpscApi-DHTzs8Ro.js";import{C as Ce}from"./Container-C8ptew7M.js";import{E as Se,D as ve}from"./Edit-D3ArGjJU.js";function Ne(r){return Y("MuiDialogContent",r)}G("MuiDialogContent",["root","dividers"]);const we=["className","dividers"],Be=r=>{const{classes:i,dividers:d}=r;return Z({root:["root",d&&"dividers"]},Ne,i)},Te=K("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(r,i)=>{const{ownerState:d}=r;return[i.root,d.dividers&&i.dividers]}})(({theme:r,ownerState:i})=>B({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},i.dividers?{padding:"16px 24px",borderTop:`1px solid ${(r.vars||r).palette.divider}`,borderBottom:`1px solid ${(r.vars||r).palette.divider}`}:{[`.${ce.root} + &`]:{paddingTop:0}})),Ee=c.forwardRef(function(i,d){const b=Q({props:i,name:"MuiDialogContent"}),{className:m,dividers:g=!1}=b,f=V(b,we),x=B({},b,{dividers:g}),y=Be(x);return t.jsx(Te,B({className:X(y.root,m),ownerState:x,ref:d},f))}),Me=async(r,i)=>{try{await ee({method:"POST",url:"https://virtullearning.cloudjiffy.net/elearnkpscadmin/subject/v1/createSubject",headers:i,data:JSON.stringify(r)}).then(function(d){console.log(d),d.data.responseCode===201?alert("Subject Successfully Created"):alert(d)})}catch(d){alert(d)}},Le=[{id:"subjectId",label:"ID",align:"center"},{id:"subjectName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"jobPostName",label:"JobPost",minWidth:200,align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Created Date",align:"center"},{id:"updatedDate",label:"Modified Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],We=()=>{te();const[r,i]=c.useState(0),[d,b]=c.useState(10),[m,g]=c.useState([]),[f,x]=c.useState([]),[y,u]=c.useState(!1),[I,T]=c.useState(!1),[n,D]=c.useState({subjectName:"",description:"",jobPostId:""}),[j,C]=c.useState({}),[P,S]=c.useState(!1),[F,U]=c.useState(null),[ke,E]=c.useState(!0),v=JSON.parse(sessionStorage.getItem("user")),p={"Content-type":"application/json",Authorization:"Bearer "+v.accessToken},J=(e,o)=>{i(o)},O=e=>{b(+e.target.value),i(0)},h=async()=>{try{const o=(await xe(p)).data.content;if(o){const a=o.map(s=>({subjectId:s.subjectId,subjectName:s.subjectName,description:s.description,jobPostId:s.jobPostDtoList?s.jobPostDtoList.jobPostId:null,insertedDate:A(s.insertedDate).format("L"),updatedDate:A(s.updatedDate).format("L"),createdBy:s.createdBy?s.createdBy.userName:"No User",updatedBy:s.updatedBy?s.updatedBy.userName:"No User"}));g(a)}else g([])}catch(e){console.error("Error fetching data:",e)}},W=async()=>{try{const e=await Pe(p);e.data&&(x(e.data),E(!1))}catch(e){console.error("Error fetching job posts:",e),E(!1)}};c.useEffect(()=>{h(),W()},[P]);const M=()=>{const e={};return(!n.subjectName||n.subjectName.trim()==="")&&(e.subjectName="Enter the subject name"),(!n.description||n.description.trim()==="")&&(e.description="Enter the description"),n.jobPostId||(e.jobPostId="Select a job post"),e},N=e=>{D({...n,[e.target.name]:e.target.value}),C({...j,[e.target.name]:null})},_=()=>{T(!1),D({subjectName:"",description:"",jobPostId:""}),u(!0)},$=async e=>{e.preventDefault();const o=M();if(Object.keys(o).length>0){C(o);return}const a={subjectName:n.subjectName,description:n.description,jobPostDtoList:{jobPostId:n.jobPostId},createdBy:{userId:v.userId}};try{const s=await Me(a,p);s.data.responseCode===200?(S(!P),u(!1),h()):alert(s.data.errorMessage||"Failed to add subject.")}catch(s){console.error("Error posting data:",s)}finally{h(),u(!1)}},q=async e=>{T(!0),u(!0);try{const a=(await ye(e,p)).data;U(a.subjectId),D({subjectName:a.subjectName,description:a.description,jobPostId:a.jobPostDtoList?a.jobPostDtoList.jobPostId:""})}catch(o){console.error("Error fetching subject details:",o)}},H=async e=>{e.preventDefault();const o=M();if(Object.keys(o).length>0){C(o);return}const a={subjectId:F,subjectName:n.subjectName,description:n.description,jobPostDtoList:{jobPostId:n.jobPostId},updatedBy:{userId:v.userId}};try{const s=await Ie(a,p);s.data.responseCode===201?(S(!P),u(!1),h()):alert(s.data.errorMessage||"Failed to update subject.")}catch(s){console.error("Error updating data:",s)}finally{h(),u(!1)}},z=async e=>{if(window.confirm("Are you sure you want to delete this item?"))try{const a=await De(e,p);a.data.responseCode===200?S(!P):alert(a.data.errorMessage||"Failed to delete subject.")}catch(a){console.error("Error deleting data:",a)}};return t.jsxs(se,{title:"Subjects",children:[t.jsxs(Ce,{children:[t.jsx(ae,{sx:{py:2},children:t.jsx(w,{variant:"contained",color:"primary",onClick:_,startIcon:t.jsx(le,{}),children:"Add Subject"})}),t.jsx(ue,{component:oe,children:t.jsxs(je,{children:[t.jsx(be,{children:t.jsx(R,{children:Le.map(e=>t.jsx(l,{align:e.align,children:e.label},e.id))})}),t.jsx(pe,{children:m.map(e=>{const o=f.find(a=>a.jobPostId===e.jobPostId);return t.jsxs(R,{children:[t.jsx(l,{children:e.subjectId}),t.jsx(l,{children:e.subjectName}),t.jsx(l,{children:e.description}),t.jsx(l,{children:o?o.jobPostName:"No Job Post"}),t.jsx(l,{children:e.createdBy}),t.jsx(l,{children:e.updatedBy}),t.jsx(l,{children:e.insertedDate}),t.jsx(l,{children:e.updatedDate}),t.jsxs(l,{children:[t.jsx(L,{color:"primary",onClick:()=>q(e.subjectId),children:t.jsx(Se,{})}),t.jsx(L,{color:"secondary",onClick:()=>z(e.subjectId),children:t.jsx(ve,{})})]})]},e.subjectId)})})]})}),t.jsx(he,{rowsPerPageOptions:[10,25,50],component:"div",count:m.length,rowsPerPage:d,page:r,onPageChange:J,onRowsPerPageChange:O})]}),t.jsxs(me,{open:y,onClose:()=>u(!1),children:[t.jsx(ge,{children:I?"Edit Subject":"Add Subject"}),t.jsx(Ee,{children:t.jsxs("form",{onSubmit:I?H:$,children:[t.jsx(k,{label:"Subject Name",name:"subjectName",value:n.subjectName,onChange:N,fullWidth:!0,error:!!j.subjectName,helperText:j.subjectName,margin:"normal"}),t.jsx(k,{label:"Description",name:"description",value:n.description,onChange:N,fullWidth:!0,error:!!j.description,helperText:j.description,margin:"normal"}),t.jsxs(re,{fullWidth:!0,margin:"normal",error:!!j.jobPostId,children:[t.jsx(ne,{children:"Job Post"}),t.jsx(ie,{value:n.jobPostId,onChange:N,name:"jobPostId",children:f.map(e=>t.jsx(de,{value:e.jobPostId,children:e.jobPostName},e.jobPostId))}),j.jobPostId&&t.jsx("p",{children:j.jobPostId})]}),t.jsxs(fe,{children:[t.jsx(w,{type:"submit",variant:"contained",color:"primary",children:I?"Update":"Add"}),t.jsx(w,{onClick:()=>u(!1),color:"secondary",children:"Cancel"})]})]})})]})]})};export{We as default};
