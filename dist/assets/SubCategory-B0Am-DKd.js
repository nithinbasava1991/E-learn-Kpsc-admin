import{u as X,r as n,j as t,M as Y,B as I,a as v,G as l,g as Z,P as $,I as P,T as D,F as ee,h as te,S as ae,k as re}from"./index-DvYQWpR8.js";import{d as se,T as oe,a as ne,b as ie,c as w,e as k,f as de,g as ce,D as le,h as ge,i as ue}from"./Add-DE-rMGZW.js";import{h as W}from"./moment-G82_0lEo.js";import{k as ye,l as he,m as me,n as pe,o as be,p as xe}from"./kpscApi-DHTzs8Ro.js";import{E as Ce,D as fe}from"./Edit-D3ArGjJU.js";const L=[{id:"subCategoryId",label:"ID",align:"center"},{id:"subCategoryName",label:"Name",minWidth:150,align:"center"},{id:"description",label:"Description",minWidth:150,align:"center"},{id:"categoryName",label:"Category",align:"center"},{id:"videoUrl",label:"Video URL",minWidth:200,align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],Ue=()=>{X();const[p,N]=n.useState(0),[u,A]=n.useState(10),[U,S]=n.useState([]),[F,M]=n.useState([]),[R,d]=n.useState(!1),[b,x]=n.useState(!1),[s,y]=n.useState({subCategoryName:"",description:"",videoUrl:"",categoryId:""}),[i,C]=n.useState({}),[f,B]=n.useState(!1),[z,E]=n.useState(null),O=(e,a)=>{N(a)},H=e=>{A(+e.target.value),N(0)},j=JSON.parse(sessionStorage.getItem("user")),c={"Content-type":"application/json",Authorization:"Bearer "+j.accessToken},g=async()=>{try{const a=(await ye(c)).data.content;if(console.log(a),a){const o=a.map(r=>({subCategoryId:r.subCategoryId,subCategoryName:r.subCategoryName,description:r.description,categoryName:r.categoryDtoList?r.categoryDtoList.categoryName:"No categoryName",videoUrl:r.videoUrl,insertedDate:W(r.insertedDate).format("L"),updatedDate:W(r.updatedDate).format("L"),createdBy:r.createdBy?r.createdBy.userName:"No User",updatedBy:r.updatedBy?r.updatedBy.userName:"No User"}));S(o)}else S([])}catch(e){console.error("Error fetching data:",e)}},V=async()=>{try{const e=await he(c),a=e.data;if(console.log(e),a){const r=a.sort((m,Q)=>m.categoryName.localeCompare(Q.categoryName)).map(m=>({categoryId:m.categoryId,categoryName:m.categoryName}));M(r)}}catch(e){console.error("Error fetching categories:",e)}};n.useEffect(()=>{g(),V()},[f]);const T=()=>{const e={};return(!s.subCategoryName||s.subCategoryName.trim()==="")&&(e.subCategoryName="Enter the sub category name"),(!s.description||s.description.trim()==="")&&(e.description="Enter the description"),(!s.videoUrl||s.videoUrl.trim()==="")&&(e.videoUrl="Enter the videoUrl"),s.categoryId||(e.categoryId="Select a category"),e},h=e=>{y({...s,[e.target.name]:e.target.value}),C({...i,[e.target.name]:null})},G=()=>{x(!1),y({subCategoryName:"",description:"",videoUrl:"",categoryId:""}),d(!0)},J=async e=>{e.preventDefault();const a=T();if(Object.keys(a).length>0){C(a);return}const o={subCategoryName:s.subCategoryName,description:s.description,videoUrl:s.videoUrl,categoryDtoList:{categoryId:s.categoryId},createdBy:{userId:j.userId}};console.log(o);try{const r=await me(o,c);r.data.responseCode===201?(B(!f),d(!1),g()):alert(r.data.errorMessage||"Failed to add sub category.")}catch{}g(),d(!1)},_=async e=>{x(!0),d(!0);try{const o=(await pe(e,c)).data;console.log(o),E(o.subCategoryId),y({subCategoryName:o.subCategoryName,description:o.description,videoUrl:o.videoUrl,categoryId:o.categoryDtoList?o.categoryDtoList.categoryId:""})}catch(a){console.error("Error fetching subject details:",a)}},q=async e=>{e.preventDefault();const a=T();if(Object.keys(a).length>0){C(a);return}const o={subCategoryId:z,subCategoryName:s.subCategoryName,description:s.description,videoUrl:s.videoUrl,categoryDtoList:{categoryId:s.categoryId},updatedBy:{userId:j.userId}};try{const r=await be(o,c);r.data.responseCode===201?(B(!f),d(!1),x(!1),E(null),y({subCategoryName:"",description:"",videoUrl:"",categoryId:""})):alert(r.data.errorMessage)}catch(r){console.error(r)}finally{g(),d(!1)}},K=async e=>{try{await xe(e,c),g()}catch(a){console.error("Error deleting subject:",a)}};return t.jsxs(Y,{title:t.jsxs(I,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:"Sub Category"}),t.jsxs(v,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:G,children:["Add",t.jsx(se,{sx:{color:"#fff"}})]})]}),children:[t.jsx(l,{container:!0,spacing:Z}),t.jsxs($,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(oe,{sx:{maxHeight:440},children:t.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(ie,{children:t.jsx(w,{children:L.map(e=>t.jsx(k,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(de,{children:U.slice(p*u,p*u+u).map(e=>t.jsx(w,{hover:!0,role:"checkbox",tabIndex:-1,children:L.map(a=>t.jsx(k,{align:a.align,children:a.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(P,{color:"primary",onClick:()=>{_(e.subCategoryId)},children:t.jsx(Ce,{})}),t.jsx(P,{color:"error",onClick:()=>{K(e.subCategoryId)},children:t.jsx(fe,{})})]}):e[a.id]},a.id))},e.subCategoryId))})]})}),t.jsx(ce,{rowsPerPageOptions:[10,25,100],component:"div",count:U.length,rowsPerPage:u,page:p,onPageChange:O,onRowsPerPageChange:H})]}),t.jsxs(le,{open:R,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[t.jsx(ge,{sx:{fontSize:"16px"},children:b?"Edit Sub Category":"Add Sub Category"}),t.jsxs(I,{component:"form",onSubmit:b?q:J,noValidate:!0,sx:{p:3},children:[t.jsxs(l,{container:!0,spacing:2,children:[t.jsx(l,{item:!0,xs:12,children:t.jsx(D,{fullWidth:!0,label:"Subject Name",name:"subCategoryName",value:s.subCategoryName,onChange:h,error:!!i.subCategoryName,helperText:i.subCategoryName})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(D,{fullWidth:!0,label:"Description",name:"description",value:s.description,onChange:h,error:!!i.description,helperText:i.description,multiline:!0,rows:3})}),t.jsx(l,{item:!0,xs:12,children:t.jsxs(ee,{fullWidth:!0,error:!!i.categoryId,sx:{mb:2},children:[t.jsx(te,{children:"Category"}),t.jsx(ae,{name:"categoryId",value:s.categoryId,onChange:h,label:"Category",children:F.map(e=>t.jsx(re,{value:e.categoryId,children:e.categoryName},e.categoryId))}),i.categoryId&&t.jsx(I,{component:"span",sx:{color:"error.main",fontSize:"0.75rem",mt:1},children:i.categoryId})]})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(D,{fullWidth:!0,label:"VideoUrl ",name:"videoUrl",value:s.videoUrl,onChange:h,error:!!i.videoUrl,helperText:i.videoUrl})})]}),t.jsxs(ue,{children:[t.jsx(v,{type:"submit",variant:"contained",color:"primary",children:b?"Update":"Add"}),t.jsx(v,{onClick:()=>d(!1),children:"Cancel"})]})]})]})]})};export{Ue as default};
