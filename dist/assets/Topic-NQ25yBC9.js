import{b as g,c as f,u as X,r as l,j as t,M as Z,B as E,a as D,G as m,g as ee,P as te,I as P,T as C,F as ae,h as oe,S as re,k as se,l as ie}from"./index-DvYQWpR8.js";import{d as de,T as le,a as ne,b as ce,c as M,e as k,f as pe,g as ue,D as me,h as he,i as ge}from"./Add-DE-rMGZW.js";import{h as W}from"./moment-G82_0lEo.js";import{c as fe}from"./ModuleApi-BBI_U3Z5.js";import{E as xe,D as ye}from"./Edit-D3ArGjJU.js";const je=async d=>await g({method:"GET",url:`${f}/topic/v1/getAllTopicByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:d}),Ie=async(d,n)=>{try{return await g({method:"POST",url:`${f}/topic/v1/createTopic`,headers:n,data:d}).then(function(o){o.data.responseCode===201?alert(o.data.message):o.data.responseCode===400&&alert(o.data.errorMessage)})}catch(o){alert(o)}},ve=async(d,n)=>await g({method:"GET",url:`${f}/topic/v1/getTopicById/{topicId}?topicId=${d}`,headers:n}),be=async(d,n)=>(console.log(d),await g({method:"PUT",url:`${f}/topic/v1/updateTopic`,headers:n,data:d}).then(function(o){console.log(o),o.data.responseCode===201?alert(o.data.message):o.data.responseCode===400&&alert(o.data.errorMessage)}).catch(function(o){console.log(o)})),Te=async(d,n)=>await g({method:"delete",url:`${f}/topic/v1/deleteTopicById/${d}`,headers:n}).then(o=>{o.data.responseCode===200?alert(o.data.message):o.data.responseCode===400&&alert(o.data.errorMessage)}).catch(o=>{console.log(o),alert(o.response.data.errorMessage)}),A=[{id:"topicId",label:"ID",align:"center"},{id:"topicName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"moduleName",label:"Modules",align:"center"},{id:"videoUrl",label:"Video",minWidth:200,align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Created Date",align:"center"},{id:"updatedDate",label:"Modified Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],Be=()=>{X();const[d,n]=l.useState(0),[o,F]=l.useState(10),[U,S]=l.useState([]),[L,$]=l.useState([]),[z,p]=l.useState(!1),[I,v]=l.useState(!1),[s,x]=l.useState({topicName:"",description:"",moduleId:"",videoUrl:""}),[c,b]=l.useState({}),[T,B]=l.useState(!1),[O,R]=l.useState(null),H=(e,a)=>{n(a)},G=e=>{F(+e.target.value),n(0)},N=JSON.parse(sessionStorage.getItem("user")),u={"Content-type":"application/json",Authorization:"Bearer "+N.accessToken},h=async()=>{try{const a=(await je(u)).data.content;if(console.log(a),a){const i=a.map(r=>({topicId:r.topicId,topicName:r.topicName,description:r.description,moduleName:r.moduleDtoList?r.moduleDtoList.moduleName:"No Module Name",videoUrl:r.videoUrl,insertedDate:W(r.insertedDate).format("L"),updatedDate:W(r.updatedDate).format("L"),createdBy:r.createdBy?r.createdBy.userName:"No User",updatedBy:r.updatedBy?r.updatedBy.userName:"No User"}));S(i)}else S([])}catch(e){console.error("Error fetching topics:",e)}},V=async()=>{try{const a=(await fe(u)).data.content;if(console.log(a),a){const r=a.sort((j,Q)=>j.moduleName.localeCompare(Q.moduleName)).map(j=>({moduleId:j.moduleId,moduleName:j.moduleName}));$(r)}}catch(e){console.error("Error fetching modules:",e)}};l.useEffect(()=>{h(),V()},[T]);const w=()=>{const e={};return(!s.topicName||s.topicName.trim()==="")&&(e.topicName="Enter the topic name"),(!s.description||s.description.trim()==="")&&(e.description="Enter the description"),(!s.videoUrl||s.videoUrl.trim()==="")&&(e.videoUrl="Enter the videoUrl"),s.moduleId||(e.moduleId="Select a module"),e},y=e=>{x({...s,[e.target.name]:e.target.value}),b({...c,[e.target.name]:null})},J=()=>{v(!1),x({topicName:"",description:"",moduleId:"",videoUrl:""}),p(!0)},Y=async e=>{e.preventDefault();const a=w();if(Object.keys(a).length>0){b(a);return}const i={topicName:s.topicName,description:s.description,videoUrl:s.videoUrl,moduleDtoList:{moduleId:s.moduleId},createdBy:{userId:N.userId}};console.log(i);try{const r=await Ie(i,u);r.data.responseCode===201?(B(!T),p(!1),h()):alert(r.data.errorMessage||"Failed to add topic.")}catch{}h(),p(!1)},_=async e=>{v(!0),p(!0);try{const i=(await ve(e,u)).data;console.log(i),R(i.topicId),x({topicName:i.topicName,description:i.description,videoUrl:i.videoUrl,moduleId:i.moduleDtoList?i.moduleDtoList.moduleId:""})}catch(a){console.error("Error fetching subject details:",a)}},q=async e=>{e.preventDefault();const a=w();if(Object.keys(a).length>0){b(a);return}const i={topicId:O,topicName:s.topicName,description:s.description,videoUrl:s.videoUrl,moduleDtoList:{moduleId:s.moduleId},updatedBy:{userId:N.userId}};try{const r=await be(i,u);r.data.responseCode===201?(B(!T),p(!1),v(!1),setSubjectId(null),x({topicName:"",description:"",videoUrl:"",moduleId:""})):alert(r.data.errorMessage)}catch(r){console.error(r)}finally{h(),p(!1)}},K=async e=>{try{await Te(e,u),h()}catch(a){console.error("Error deleting topic:",a)}};return t.jsxs(Z,{title:t.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:"Topics"}),t.jsxs(D,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:J,children:["Add",t.jsx(de,{sx:{color:"#fff"}})]})]}),children:[t.jsx(m,{container:!0,spacing:ee}),t.jsxs(te,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(le,{sx:{maxHeight:440},children:t.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(ce,{children:t.jsx(M,{children:A.map(e=>t.jsx(k,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(pe,{children:U.slice(d*o,d*o+o).map(e=>t.jsx(M,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(a=>t.jsx(k,{align:a.align,children:a.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(P,{color:"primary",onClick:()=>_(e.topicId),children:t.jsx(xe,{})}),t.jsx(P,{color:"error",onClick:()=>K(e.topicId),children:t.jsx(ye,{})})]}):a.id==="videoUrl"&&e[a.id]?t.jsx("iframe",{width:"100",height:"100",src:`http://www.youtube.com/embed/${e[a.id]}`,title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e[a.id]||"No Data"},a.id))},e.topicId))})]})}),t.jsx(ue,{rowsPerPageOptions:[10,25,100],component:"div",count:U.length,rowsPerPage:o,page:d,onPageChange:H,onRowsPerPageChange:G})]}),t.jsxs(me,{open:z,onClose:()=>p(!1),fullWidth:!0,maxWidth:"md",children:[t.jsx(he,{sx:{fontSize:"16px"},children:I?"Edit Topic":"Add Topic"}),t.jsxs(E,{component:"form",noValidate:!0,sx:{p:3},onSubmit:I?q:Y,children:[t.jsxs(m,{container:!0,spacing:2,children:[t.jsx(m,{item:!0,xs:12,children:t.jsx(C,{fullWidth:!0,label:"Topic Name",name:"topicName",value:s.topicName,onChange:y,error:!!c.topicName,helperText:c.topicName})}),t.jsx(m,{item:!0,xs:12,children:t.jsx(C,{fullWidth:!0,label:"Description",name:"description",value:s.description,onChange:y,error:!!c.description,helperText:c.description,multiline:!0,rows:3})}),t.jsx(m,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,error:!!c.moduleId,children:[t.jsx(oe,{id:"module-select",children:"Module"}),t.jsx(re,{labelId:"module-select",name:"moduleId",value:s.moduleId,onChange:y,children:L.map(e=>t.jsx(se,{value:e.moduleId,children:e.moduleName},e.moduleId))}),t.jsx(ie,{children:c.moduleId})]})}),t.jsx(m,{item:!0,xs:12,children:t.jsx(C,{fullWidth:!0,label:"VideoUrl ",name:"videoUrl",value:s.videoUrl,onChange:y,error:!!c.videoUrl,helperText:c.videoUrl})})]}),t.jsxs(ge,{children:[t.jsx(D,{type:"submit",variant:"contained",color:"primary",children:I?"Update":"Add"}),t.jsx(D,{onClick:()=>p(!1),children:"Cancel"})]})]})]})]})};export{Be as default};
