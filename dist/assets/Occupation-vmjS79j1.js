import{b as g,c as h,u as J,r as d,j as a,M as _,B as v,a as C,G as K,g as Q,P as V,I as E,T as P}from"./index-DvYQWpR8.js";import{h as w}from"./moment-G82_0lEo.js";import{d as X,T as Y,a as Z,b as ee,c as S,e as k,f as ae,g as te,D as oe,h as re,i as se}from"./Add-DE-rMGZW.js";import{E as ne,D as ce}from"./Edit-D3ArGjJU.js";import{C as ie}from"./Container-C8ptew7M.js";const de=async(n,c)=>{try{const t=await g({method:"POST",url:`${h}/gotra/v1/createOccupation`,headers:c,data:JSON.stringify(n)});console.log(t),t.data.responseCode===201?alert(t.data.message):alert(t.data.errorMessage||"An error occurred")}catch(t){alert(t.message||"An unexpected error occurred")}},le=async n=>{try{return(await g.get(`${h}/gotra/v1/getAllOccupationByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,{headers:n})).data}catch(c){throw c}},pe=async(n,c)=>await g({method:"GET",url:`${h}/gotra/v1/getOccupationByOccupationId/{occupationId}?occupationId=${c}`,headers:n}),ue=async(n,c)=>{try{const t=await g({method:"PUT",url:`${h}/gotra/v1/updateOccupation`,headers:c,data:n});t.data.responseCode===201?alert(t.data.message):t.data.responseCode===400?alert(t.data.errorMessage):alert("Unexpected response code")}catch(t){console.error("Error updating promo:",t)}},ge=async(n,c)=>{await g({method:"DELETE",url:`${h}/gotra/v1/deleteOccupationById/1`,headers:n}).then(t=>{t.data.responseCode===200?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(t=>{console.log(t)})},A=[{id:"occupationId",label:"ID",align:"center"},{id:"occupationName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Created Date",align:"center"},{id:"updatedDate",label:"Modified Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],je=()=>{J();const[n,c]=d.useState(0),[t,M]=d.useState(10),[D,N]=d.useState([]),[U,l]=d.useState(!1),[x,y]=d.useState(!1),[i,j]=d.useState({occupationName:"",description:""}),[p,B]=d.useState({}),[b,I]=d.useState(!1),[R,O]=d.useState(null),W=(e,o)=>{c(o)},$=e=>{M(+e.target.value),c(0)},m=JSON.parse(sessionStorage.getItem("user")),u={"Content-type":"application/json",Authorization:"Bearer "+m.accessToken},f=async()=>{try{const e=await le(u);console.log(e.content);const o=e.content;if(o){const r=o.map(s=>({occupationId:s.occupationId,occupationName:s.occupationName,description:s.description,insertedDate:w(s.insertedDate).format("L"),updatedDate:w(s.updatedDate).format("L"),createdBy:s.createdBy?s.createdBy.userName:"No User",updatedBy:s.updatedBy?s.updatedBy.userName:"No User"}));N(r)}else N([])}catch(e){console.error("Error fetching data:",e)}};d.useEffect(()=>{f()},[b]);const F=()=>{const e={};return(!i.occupationName||i.occupationName.trim()==="")&&(e.occupationName="Enter the occupation name"),(!i.description||i.description.trim()==="")&&(e.description="Enter the description"),e},T=e=>{j({...i,[e.target.name]:e.target.value,createdBy:{userId:m.userId}}),B({...p,[e.target.name]:null})},z=()=>{y(!1),j({occupationName:"",description:""}),l(!0)},H=async e=>{y(!0),l(!0);try{const o=await pe(u,e);console.log(e),console.log(o.data);const r=o.data;O(r.occupationId),j({occupationName:r.occupationName,description:r.description})}catch(o){console.error("Error fetching occupation details:",o)}},G=async e=>{e.preventDefault();const o=F();if(Object.keys(o).length>0){B(o);return}const r={occupationName:i.occupationName,description:i.description,createdBy:{userId:m.userId}};try{(await de(r,u)).data.responseCode===201&&(I(!b),l(!1))}catch(s){console.log(s)}f(),l(!1)},L=async e=>{e.preventDefault();const o={occupationId:R,occupationName:i.occupationName,description:i.description,updatedBy:{userId:m.userId}};try{const r=await ue(o,u);console.log(r),r.data.responseCode===201&&(I(!b),l(!1),y(!1),O(null))}catch(r){console.error(r)}f(),l(!1)},q=async e=>{try{await ge(u,e),f()}catch(o){console.error("Error deleting occupation:",o)}};return a.jsxs(_,{title:a.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:"Occupation"}),a.jsxs(C,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:z,children:["Add",a.jsx(X,{sx:{color:"#fff"}})]})]}),children:[a.jsx(K,{container:!0,spacing:Q}),a.jsxs(V,{sx:{width:"100%",overflow:"hidden"},children:[a.jsx(Y,{sx:{maxHeight:440},children:a.jsxs(Z,{stickyHeader:!0,"aria-label":"sticky table",children:[a.jsx(ee,{children:a.jsx(S,{children:A.map(e=>a.jsx(k,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600},children:e.label},e.id))})}),a.jsx(ae,{children:D.slice(n*t,n*t+t).map((e,o)=>a.jsx(S,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(r=>{const s=e[r.id];return a.jsx(k,{align:r.align,children:r.id==="actions"?a.jsxs(v,{sx:{display:"flex",justifyContent:"center"},children:[a.jsx(E,{color:"primary",sx:{padding:"5px"},onClick:()=>H(e.occupationId),children:a.jsx(ne,{})}),a.jsx(E,{color:"secondary",sx:{padding:"5px"},onClick:()=>q(e.occupationId),children:a.jsx(ce,{})})]}):s},r.id)})},o))})]})}),a.jsx(te,{rowsPerPageOptions:[10,25,100],component:"div",count:D.length,rowsPerPage:t,page:n,onPageChange:W,onRowsPerPageChange:$})]}),a.jsxs(oe,{open:U,onClose:()=>l(!1),children:[a.jsx(re,{children:x?"Edit Occupation":"Add Occupation"}),a.jsxs("form",{onSubmit:x?L:G,children:[a.jsxs(ie,{children:[a.jsx(P,{autoFocus:!0,required:!0,fullWidth:!0,margin:"dense",label:"Occupation Name",name:"occupationName",value:i.occupationName,onChange:T,error:!!p.occupationName,helperText:p.occupationName}),a.jsx(P,{required:!0,fullWidth:!0,margin:"dense",label:"Description",name:"description",value:i.description,onChange:T,error:!!p.description,helperText:p.description})]}),a.jsxs(se,{children:[a.jsx(C,{type:"submit",children:x?"Update":"Add"}),a.jsx(C,{variant:"contained",color:"secondary",onClick:()=>l(!1),children:"Cancel"})]})]})]})]})};export{je as default};
