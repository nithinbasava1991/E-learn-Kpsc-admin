import{b as h,c as d,u as ee,r as c,j as e,M as se,d as E,a as x,G as y,g as te,P as ae,I as F,T as N}from"./index-DvYQWpR8.js";import{h as $}from"./moment-G82_0lEo.js";import{d as re,T as oe,a as ne,b as ce,c as k,e as U,f as ie,g as le,D as de,h as ue,i as he}from"./Add-DE-rMGZW.js";import{d as pe,a as me}from"./DeleteForever-BLSPA7Rs.js";const ge=async o=>await h({method:"get",url:`${d}/success/v1/getAllSuccessStoryByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:o}),ye=async(o,l)=>await h({method:"GET",url:`${d}/success/v1/getSuccessStoryById/{successstoryId}?successstoryId=${o}`,headers:l}),fe=async(o,l)=>(console.log(o),await h({method:"PUT",url:`${d}/success/v1/updateSuccessStory`,headers:l,data:o}).then(function(t){console.log(t),t.data.responseCode===201?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(function(t){console.log(t)})),xe=async(o,l)=>await h({method:"delete",url:`${d}/success/v1/deleteSuccessStoryById/${o}`,headers:l}).then(t=>{t.data.responseCode===200?alert(t.data.message):t.data.responseCode===400&&alert(t.data.errorMessage)}).catch(t=>{console.log(t)}),Se=async(o,l)=>{try{return await h({method:"POST",url:`${d}/success/v1/createSuccessStory`,headers:l,data:o}).then(function(t){console.log(t),t.data.responseCode===201?alert("Advertisement  added successfully"):t.data.responseCode===400&&alert(t.data.errorMessage)})}catch(t){alert(t)}},A=[{id:"successstoryId",label:"ID",align:"center"},{id:"successstoryName",label:"Name",align:"center",minWidth:200},{id:"description",label:"Description",minWidth:200,align:"center"},{id:"file",label:"File",align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],De=()=>{ee();const[o,l]=c.useState(0),[t,W]=c.useState(10),[j,b]=c.useState([]),[S,w]=c.useState(!1),[M,p]=c.useState(!1),[R,z]=c.useState(null),[Ne,I]=c.useState(""),[u,C]=c.useState({}),[D,O]=c.useState(null),P=c.useRef(null),[je,v]=c.useState(""),[G,B]=c.useState(!1),[i,m]=c.useState({successstoryName:"",description:""}),H=(s,a)=>{l(a)},_=s=>{W(+s.target.value),l(0)},f=JSON.parse(sessionStorage.getItem("user")),g={"Content-type":"application/json",Authorization:`Bearer ${f.accessToken}`},L=`${d}/file/downloadFile/?filePath=`,J=async()=>{try{const a=(await ge(g)).data.content;if(a){const r=a.map(n=>({successstoryId:n.successstoryId,successstoryName:n.successstoryName,description:n.description,file:n.photoPath?e.jsx("img",{src:L+n.photoPath,alt:n.photoName,style:{width:150,height:100}}):"NO IMAGE FOUND",insertedDate:$(n.insertedDate).format("L"),updatedDate:$(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));b(r)}else b([])}catch(s){console.error("Error fetching data:",s)}};c.useEffect(()=>{J()},[G]);const V=()=>{const s={};return i.successstoryName.trim()||(s.successstoryName="Enter the News"),i.description.trim()||(s.description="Enter the Description"),(!i.photoName||i.photoName.trim()==="")&&(s.photoName="Select the file"),s},T=s=>{m({...i,[s.target.name]:s.target.value}),C(a=>({...a,[s.target.name]:null}))},q=async s=>{try{await xe(s,g),B(a=>!a)}catch(a){console.error("Error deleting news:",a)}},K=async s=>{w(!0),p(!0);try{const r=(await ye(s,g)).data;z(r.successstoryId),m({successstoryName:r.successstoryName,description:r.description,photoName:r.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},Q=async s=>{if(s.preventDefault(),!D){v("Please select a file");return}const a=new FormData;a.append("file",D);try{const r=await h.post(`${d}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${f.accessToken}`}});I(r.data.fileName),m(n=>({...n,photoName:r.data.fileName})),v(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},X=s=>{I(s.target.files[0].name),O(s.target.files[0])},Y=async s=>{s.preventDefault();const a=V();if(console.log(i),Object.keys(a).length>0)C(a);else try{if(S){const r={...i,successstoryId:R,updatedBy:{userId:f.userId}};await fe(r,g)}else{const r={...i,createdBy:{userId:f.userId}};await Se(r,g)}m({successstoryName:"",description:"",photoName:""}),P.current.value=null,B(r=>!r),p(!1)}catch(r){console.error("Error saving news:",r)}},Z=()=>{w(!1),m({successstoryName:"",description:"",photoName:""}),p(!0)};return e.jsxs(se,{title:e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(x,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Z,children:["Add",e.jsx(re,{sx:{color:"#fff"}})]})]}),children:[e.jsx(y,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(oe,{sx:{maxHeight:440},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ce,{children:e.jsx(k,{children:A.map(s=>e.jsx(U,{align:s.align,style:{minWidth:s.minWidth,fontWeight:600,fontSize:15},children:s.label},s.id))})}),e.jsx(ie,{children:j.slice(o*t,o*t+t).map(s=>e.jsx(k,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(a=>e.jsx(U,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>K(s.successstoryId),color:"primary",children:e.jsx(pe,{})}),e.jsx(F,{onClick:()=>q(s.successstoryId),color:"error",children:e.jsx(me,{})})]}):s[a.id]},a.id))},s.successstoryId))})]})}),e.jsx(le,{rowsPerPageOptions:[10,25,100],component:"div",count:j.length,rowsPerPage:t,page:o,onPageChange:H,onRowsPerPageChange:_})]}),e.jsxs(de,{open:M,onClose:()=>p(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(ue,{sx:{fontSize:"16px"},children:S?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(E,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:i.successstoryName,onChange:T,error:!!u.successstoryName,helperText:u.successstoryName})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:T,error:!!u.description,helperText:u.description,multiline:!0,rows:3})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(N,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:i.photoName,disabled:!0,helperText:u.photoName,error:!!u.photoName,InputProps:{endAdornment:e.jsx(x,{variant:"contained",color:"primary",onClick:Q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:P,style:{marginTop:20}})]})]}),e.jsxs(he,{children:[e.jsx(x,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:S?"Update":"Save"})]})]})]})]})};export{De as default};
